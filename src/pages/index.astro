---
import '../styles/global.css'
import Navigation from '../components/Navigation.astro'
import Hero from '../components/Hero.astro'
import Section from '../components/Section.astro'
import Gallery from '../components/Gallery.astro'
import Button from '../components/Button.astro'
import Footer from '../components/Footer.astro'
import LanguageDetector from '../components/LanguageDetector.astro'
import { getTranslations, useTranslations } from '../i18n/utils.js'

const lang = 'en'
const translations = await getTranslations(lang)
const t = useTranslations(translations)

// Gallery images data
const galleryImages = [
  {
    src: `${import.meta.env.BASE_URL}beach_bar.jpeg`,
    alt: "Beach Bar Joni - Beachfront View"
  },
  {
    src: `${import.meta.env.BASE_URL}beach_bar_1.jpeg`,
    alt: "Beach Bar Joni - Outdoor Seating"
  },
  {
    src: `${import.meta.env.BASE_URL}beach_bar_2.jpeg`,
    alt: "Beach Bar Joni - Bar Interior"
  },
  {
    src: `${import.meta.env.BASE_URL}drinks.jpeg`,
    alt: "Beach Bar Joni - Cocktails and Drinks"
  }
];
---

<html lang={lang}>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{t('meta.title')}</title>
		<meta name="description" content={t('meta.description')} />

		<!-- Favicons -->
		<link rel="icon" type="image/x-icon" href={`${import.meta.env.BASE_URL}favicon.ico`} />
		<link rel="icon" type="image/png" sizes="16x16" href={`${import.meta.env.BASE_URL}favicon-16x16.png`} />
		<link rel="icon" type="image/png" sizes="32x32" href={`${import.meta.env.BASE_URL}favicon-32x32.png`} />
		<link rel="apple-touch-icon" sizes="180x180" href={`${import.meta.env.BASE_URL}apple-touch-icon.png`} />

		<!-- Theme color for mobile browsers -->
		<meta name="theme-color" content="#2563eb" />
		<meta name="msapplication-TileColor" content="#2563eb" />
	</head>
	<body class="bg-white">
		<!-- Language Detection -->
		<LanguageDetector currentLang={lang} />

		<!-- Navigation -->
		<Navigation currentPage="home" lang={lang} translations={translations} />

		<!-- Hero Section -->
		<Hero
			title={t('hero.title')}
			subtitle={t('hero.subtitle')}
			backgroundImage={`${import.meta.env.BASE_URL}beach_bar.jpeg`}
			showButtons={true}
			lang={lang}
			translations={translations}
		/>

		<!-- Gallery Section -->
		<Section
			id="gallery"
			background="gray"
		>
			<Gallery images={galleryImages} />
		</Section>

		<!-- Location Section -->
		<Section
			id="location"
			title={t('location.title')}
			subtitle={t('location.subtitle')}
		>
			<div class="items-start gap-12 grid grid-cols-1 lg:grid-cols-2">
				<!-- Info Cards -->
				<div class="space-y-8">
					<div class="bg-white shadow-md hover:shadow-lg p-6 rounded-xl transition-shadow">
						<h3 class="mb-3 font-semibold text-gray-900 text-xl">{t('location.address')}</h3>
						<p class="text-gray-600 leading-relaxed" set:html={t('location.addressText').replace(/\n/g, '<br>')}></p>
					</div>
					<div class="bg-white shadow-md hover:shadow-lg p-6 rounded-xl transition-shadow">
						<h3 class="mb-3 font-semibold text-gray-900 text-xl">{t('location.hours')}</h3>
						<p class="text-gray-600 leading-relaxed" set:html={t('location.hoursText').replace(/\n/g, '<br>')}></p>
					</div>

				</div>

				<!-- Map -->
				<div class="bg-white shadow-md rounded-xl overflow-hidden">
					<iframe
						src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d430.53103835591605!2d19.52006358162717!3d41.25247109878686!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x134fdfe5c479096b%3A0x14f9543b2e829c61!2sBar%20Joni!5e0!3m2!1sen!2s!4v1748549732858!5m2!1sen!2s"
						allowfullscreen=""
						loading="lazy"
						referrerpolicy="no-referrer-when-downgrade"
						title="Bar Joni Location in Golem, Albania"
						class="w-full h-96"
					>
					</iframe>
				</div>
			</div>
		</Section>

		<!-- Contact Section -->
		<Section
			id="contact"
			background="gray"
		>
			<div class="space-y-8 mx-auto max-w-4xl text-center">
				<p class="text-gray-700 text-lg leading-relaxed">
				</p>
				<div class="flex sm:flex-row flex-col justify-center gap-4">
					<Button
						href="https://www.instagram.com/beach_bar_joni/"
						target="_blank"
						rel="noopener"
						variant="primary"
						size="lg"
					>
						<span class="mr-2">üì±</span>
						{t('contact.followInstagram')}
					</Button>
					<Button
						href="https://www.google.com/maps/place/Bar+Joni/@41.2524711,19.5200636,430m/data=!3m1!1e3!4m6!3m5!1s0x134fdfe5c479096b:0x14f9543b2e829c61!8m2!3d41.2524711!4d19.5200636!16s%2Fg%2F11y3k8qx8q"
						target="_blank"
						rel="noopener"
						variant="outline"
						size="lg"
					>
						<span class="mr-2">üìç</span>
						{t('contact.getDirections')}
					</Button>
				</div>
			</div>
		</Section>

		<!-- Footer -->
		<Footer lang={lang} translations={translations} />

		<!-- Instagram Embed Script -->
		<script is:inline async src="https://www.instagram.com/embed.js"></script>

		<!-- Visitor Tracking Script -->
		<script is:inline>
			// Enhanced visitor tracking with better error handling
			function trackVisitor() {
				const scriptUrl = 'https://script.google.com/macros/s/AKfycbxvZNXq1f3CU8pEg-pgsij9VICglp62bLKH1l0YRPe4k4GdOFvvLaA0rmNQ2XzqrPRz0Q/exec';

				const params = new URLSearchParams({
					url: window.location.href,
					userAgent: navigator.userAgent,
					timestamp: new Date().toISOString(),
					referrer: document.referrer || 'direct'
				});

				// Try with fetch first
				fetch(`${scriptUrl}?${params}`, {
					method: "GET",
					mode: "no-cors"
				})
				.then(() => {
					console.log("Visitor tracking: Request sent successfully");
				})
				.catch((error) => {
					console.warn("Visitor tracking: Fetch failed, trying alternative method", error);

					// Fallback: Try with image pixel method
					const img = new Image();
					img.onload = () => console.log("Visitor tracking: Image pixel method succeeded");
					img.onerror = () => console.warn("Visitor tracking: All methods failed");
					img.src = `${scriptUrl}?${params}`;
				});
			}

			// Track visitor when page loads
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', trackVisitor);
			} else {
				trackVisitor();
			}
		</script>
	</body>
</html>
